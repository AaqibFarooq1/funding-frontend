---
applications:
  - name: funding-frontend
    env:
      RAILS_ENV: production
    services:
      - funding-frontend
      - log-drain
      - funding-frontend-uploads
    processes:
      - type: web
        command: bundle exec rake cf:on_first_instance db:migrate && rails s -p $PORT
        memory: 256M
        instances: 2
        # TODO: Review once upstream issue https://github.com/cloudfoundry/ruby-buildpack/issues/120 is resolved
        buildpack: https://github.com/cloudfoundry/ruby-buildpack.git#v1.8.4
        health-check-type: http
        health-check-http-endpoint: /health
        routes:
  	      - route: funding.heritagefund.org.uk

      - type: worker
        command: bundle exec rake jobs:work
        health-check-type: process
        instances: 1
        memory: 1GB

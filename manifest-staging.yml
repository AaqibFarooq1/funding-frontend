---
applications:
- name: funding-frontend-staging
  env:
    RAILS_ENV: staging
    RUBYOPT: -W:no-deprecated
  services:
    - funding-frontend-staging
    - log-drain
    - funding-frontend-staging-uploads
  processes:
  - type: web
    command: bundle exec rake cf:on_first_instance db:migrate && rails s -p $PORT
    memory: 256M
    instances: 2
    buildpack: https://github.com/cloudfoundry/ruby-buildpack.git
    health-check-type: http
    health-check-http-endpoint: /health

  - type: worker
    command: bundle exec rake jobs:work
    health-check-type: process
    instances: 1
    memory: 1GB

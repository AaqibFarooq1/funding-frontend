<% content_for :page_title, "Cash contributions"  %>
<div class="govuk-grid-row">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <span class="govuk-caption-xl">Support for your project</span>
      <h1 class="govuk-heading-xl">Cash contributions</h1>
    </div>
  </div>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-one-third">
      <%= form_with model: @project, url: three_to_ten_k_project_project_cash_contribution_path, method: :put do |f| %>
        <% f.fields_for :cash_contributions, @cash_contribution do |cc| %>
        <div class="nlhf-add-item">
          <header class="nlhf-add-item__header">
            <h2 class="govuk-heading-l nlhf-add-item__header__title">Add a cash contribution</h2>
          </header>
          <div class="nlhf-add-item__body">
            <div class="nlhf-add-item__row">
              <div class="govuk-character-count" data-module="govuk-character-count" data-maxwords="50">
                <div class="govuk-form-group">
                  <%= cc.label :description, class: 'govuk-label' %>
                  <%= cc.text_area :description, class: 'govuk-textarea' %>
                </div>
              </div>
            </div>
            <div class="nlhf-add-item__row">
              <div class="govuk-form-group">
                <fieldset class="govuk-fieldset">
                  <legend class="govuk-fieldset__legend govuk-fieldset__legend">
                    Is this cash contribution secured?
                  </legend>
                  <div class="govuk-radios govuk-radios--small">
                    <div class="govuk-radios__item">
                      <%= cc.radio_button :secured, :yes_with_evidence, class: "govuk-radios__input" %>
                      <%= cc.label :secured_yes_with_evidence, 'Yes<br> <span class="govuk-!-font-size-16">I can provide evidence</span>'.html_safe, class: "govuk-label govuk-radios__label" %>
                    </div>
                    <div class="govuk-radios__item">
                      <%= cc.radio_button :secured, :yes_no_evidence_yet, class: "govuk-radios__input" %>
                      <%= cc.label :secured_no_evidence_yet, 'Yes<br> <span class="govuk-!-font-size-16">but I do not have evidence yet</span>'.html_safe, class: "govuk-label govuk-radios__label"%>
                    </div>
                    <div class="govuk-radios__item">
                      <%= cc.radio_button :secured, :no, class: "govuk-radios__input" %>
                      <%= cc.label :secured_no, 'No', class: "govuk-label govuk-radios__label" %>
                    </div>
                    <div class="govuk-radios__item">
                      <%= cc.radio_button :secured, :x_not_sure, class: "govuk-radios__input" %>
                      <%= cc.label :secured_x_not_sure, 'Not sure', class: "govuk-label govuk-radios__label"   %>
                    </div>
                  </div>
                </fieldset>
                <%# TODO: Only show this if user selects yes with evidence %>
                <%= cc.label :cash_contribution_evidence_files, "Select supporting evidence", class: 'govuk-label' %>
                <%= cc.file_field :cash_contribution_evidence_files, class: 'govuk-file-upload' %>
              </div>
            </div>
            <div class="nlhf-add-item__row">
              <div class="govuk-form-group">
              <%= cc.label :amount, class: 'govuk-label' %>
              <%= cc.number_field :amount, min: 1, class: 'govuk-input' %>
              </div>
            </div>
            <div class="nlhf-add-item__row">
              <%= cc.submit 'Add cash contribution', role: "button", 'data-prevent-double-click' => 'true', class: 'govuk-button govuk-button--secondary'%>
            </div>
          </div>
        </div>
        <!-- /.nlhf-add-item -->
          <% end %>
      <% end %>
      <!-- /add-cost form -->
    </div>

    <div class="govuk-grid-column-two-thirds">
      <div class="nlhf-highlight-content nlhf-highlight-content--help">
        <h3 class="govuk-heading-m govuk-!-margin-bottom-3">What do we mean by cash contributions?</h3>
        <p class="govuk-body">
          Cash contributions include any additional funds you expect to receive for your project.
        </p>
        <h3 class="govuk-heading-m govuk-!-margin-bottom-3">What is a secured contribution?</h3>
        <p class="govuk-body">
          By secured we mean the cash in your bank account reserved specifically for this project, or grant money has been formally offered. You can add evidence later in your application.
        </p>
        <h3 class="govuk-heading-m govuk-!-margin-bottom-3">Do I need cash contributions?</h3>
        <p class="govuk-body govuk-!-margin-bottom-3">
          You do not need to have cash contributions at this grant level, so don't worry if you cannot add anything to this section.
        </p>
        <div class="govuk-inset-text govuk-!-margin-top-0 govuk-!-margin-bottom-0">
          Once you tell us that you are getting money from elsewhere, we will need to see evidence of this, as it helps with our assessment.
        </div>
      </div>
      <section class="nlhf-summary nlhf-summary--cash">
        <header class="nlhf-summary__header">
          <h2 class="govuk-heading-m">Your cash contributions</h2>
        </header>
        <%# TODO: Need design for cash contributions display %>
        <div class="nlhf-summary__body">
            <% if @project.cash_contributions.empty? %>
          <h3 class="govuk-heading-m govuk-!-margin-bottom-0">You have not added any cash contributions</h3>
            <% else %>
          <% @project.cash_contributions.filter{ |cc| cc.description.present? }.each do |cc| %>
           <ul>
              <%= content_tag(:li, cc.description) %>
                <ul>
                  <%= content_tag(:li, "Amount:  #{number_to_currency(cc.amount, strip_insignificant_zeros: true)}") if cc.amount.present? %>
                  <%= content_tag(:li, link_to(cc.cash_contribution_evidence_files.blobs.first.filename, rails_blob_path(cc.cash_contribution_evidence_files.first, disposition: "attachment"))) if cc.cash_contribution_evidence_files.present?  %>
                </ul>
            </ul>
            <% end %>
          <% end %>

        </div>
        <!-- /.nlhf-summary__body -->
      </section>
      <!-- /.nlhf-summary-container -->
    </div>
  </div>
  <hr class="govuk-section-break--l govuk-section-break--visible">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <form action="process-cash-contributions" method="post">
        <p class="govuk-body">If you have finished adding all your cash contributions</p>
        <button data-prevent-double-click="true" class="govuk-button" data-module="govuk-button">
          Save and continue
        </button>
      </form></div>
  </div>
</div>

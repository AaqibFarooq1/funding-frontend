<% if @project.errors.any? %>

<% @project.errors.each do |attr, msg| %>

<% end %>

  document.title = "Error: Cash contributions";

  addSummaryErrors();

  addFormGroupErrors(
      "cash_contributions.description",
      "description-form-group",
      "description-errors"
  );

  addFormGroupErrors(
      "cash_contributions.secured",
      "secured-form-group",
      "secured-errors"
  );

  addFormGroupErrors(
      "cash_contributions.amount",
      "amount-form-group",
      "amount-errors"
  );

  <% if @project.errors.include?(:cash_contribution_evidence_files) %>
    addErrorToFileField();
  <% end %>

<% end %>

function addSummaryErrors() {

    var summaryErrorsElement = document.getElementById("summary-errors");
    summaryErrorsElement.classList.add("govuk-error-summary");
    summaryErrorsElement.setAttribute("aria-labelledby", "error-summary-title");
    summaryErrorsElement.setAttribute("role", "alert");
    summaryErrorsElement.setAttribute("tabindex", "-1");
    summaryErrorsElement.setAttribute("data-module", "govuk-error-summary");

    if (!summaryErrorsElement.innerHTML.includes("h2")) {
        var summaryErrorsHeading = document.createElement("h2");
        summaryErrorsHeading.classList.add("govuk-error-summary__title");
        summaryErrorsHeading.setAttribute("id", "error-summary-title");
        summaryErrorsHeading.innerText = "There is a problem";
        summaryErrorsElement.appendChild(summaryErrorsHeading);
    }

    if (!summaryErrorsElement.innerHTML.includes("div")) {
        var summaryErrorsBodyElement = document.createElement("div");
        summaryErrorsBodyElement.classList.add("govuk-error-summary__body");
        summaryErrorsElement.appendChild(summaryErrorsBodyElement);
    }

    if (!summaryErrorsElement.innerHTML.includes("ul")) {
        var summaryErrorsList = document.createElement("ul");
        summaryErrorsList.classList.add("govuk-list")
        summaryErrorsList.classList.add("govuk-error-summary__list");
        summaryErrorsBodyElement.appendChild(summaryErrorsList);
    }

    <% @project.errors.each do |attr, msg| %>

    if (!summaryErrorsElement.innerHTML.includes("<%= msg %>")) {

        var listItemElement = document.createElement("li");
        var linkElement = document.createElement("a");

        linkElement.setAttribute("data-turbolinks", "false");
        linkElement.setAttribute("href", "#<%= attr.to_s == "capital_work" ? "project_capital_work_false" : "project_capital_work_true" %>");
        linkElement.innerText = "<%= msg %>";

        listItemElement.appendChild(linkElement)
        summaryErrorsList.appendChild(listItemElement);

    }

    <% end %>

}

function addFormGroupErrors(model_field, form_group, errors_element) {

    var descriptionFormGroupElement = document.getElementById(form_group);
    descriptionFormGroupElement.classList.add("govuk-form-group--error");

    var descriptionFormGroupErrorsElement = document.getElementById(errors_element);

    <% @project.errors.each do |attr, msg| %>

      if (model_field == "<%= attr.to_s %>") {

        if (!descriptionFormGroupErrorsElement.innerHTML.includes("<%= msg %>")) {

            var spanElement = document.createElement("span");
            spanElement.setAttribute("id", "project[<%= attr %>]-error");
            spanElement.classList.add("govuk-error-message");
            spanElement.innerHTML = "<span class='govuk-visually-hidden'>Error: </span><%= msg %>";

            descriptionFormGroupErrorsElement.appendChild(spanElement);

        }

      }

    <% end %>

}

function addErrorToFileField() {

    var fileUploadGroup = document.getElementById("file-upload-group");

    <% @project.errors.each do |attr, msg| %>

    <% if attr.to_s == "cash_contribution_evidence_files" %>

      if (!fileUploadGroup.innerHTML.includes("<%= msg %>")) {

          var spanElement = document.createElement("span");
          spanElement.setAttribute("id", "cash_contribution_evidence_files-error");
          spanElement.classList.add("govuk-error-message");
          spanElement.innerHTML = "<span class='govuk-visually-hidden'>Error: </span><%= msg %>";

          var fileField = document.getElementById("cash_contribution_evidence_files");
          fileField.classList.add("govuk-file-upload--error");
          fileField.setAttribute("aria-describedby", "cash_contribution_evidence_files-error");

          fileUploadGroup.prepend(spanElement);

      }

    <% end %>

    <% end %>

}
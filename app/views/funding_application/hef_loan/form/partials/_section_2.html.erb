<div class="govuk-form-group <%= 'govuk-form-group--error' if 
  @funding_application.people.first.errors.any? || 
    @funding_application.people.second.errors.any? %>">

  <h2 class="govuk-heading-l"><%= t("form.contact_details.heading")%></h2>

  <p class="govuk-body govuk-!-margin-bottom-8">
    <%= t("form.contact_details.sub_heading")%>
  </p>

  <%= form_object.fields_for :people, @funding_application.people.sort_by(&:created_at) do | p | %>

    <fieldset class="govuk-fieldset govuk-!-margin-bottom-8">
      <legend class="govuk-!-margin-bottom-3">
        <h3 class="govuk-heading-m">
          <%#
            We are using p.index + 1 here to display '1' and '2'
            as :people is zero-indexed
          %>
          <%= t("form.contact_details.contact_heading")%> <%= p.index + 1 %>
        </h3>
      </legend>

      <div class="govuk-form-group <%= 'govuk-form-group--error' if 
        @funding_application.people[p.index].errors[:name].any? %>">

        <%= 
          p.label t("form.contact_details.full_name"),
          class: 'govuk-label govuk-label--s'
        %>

        <%=
          render partial: "partials/form_input_errors",
                locals: {
                    form_object: @funding_application.people[p.index],
                    input_field_id: :name
                } if @funding_application.people[p.index].errors[:name].any?
        %>

        <%=
            p.text_field :name,
                          class: "govuk-input #{'govuk-input--error' if 
                            @funding_application.people[p.index].errors[:name].any? }"
        %>

      </div>

      <div class="govuk-form-group <%= 'govuk-form-group--error' if 
        @funding_application.people[p.index].errors[:position].any? %>">
        
        <%= 
          p.label t("form.contact_details.position"),
          class: 'govuk-label govuk-label--s'
        %>

        <%=
          render partial: "partials/form_input_errors",
                locals: {
                    form_object: @funding_application.people[p.index],
                    input_field_id: :position
                } if @funding_application.people[p.index].errors[:position].any?
        %>

        <%=
            p.text_field :position,
                          class: "govuk-input #{'govuk-input--error' if 
                            @funding_application.people[p.index].errors[:position].any? }"
        %>

      </div>

      <div class="govuk-form-group <%= 'govuk-form-group--error' if @funding_application.people[p.index].errors[:email].any? %>">
      
        <%= 
          p.label t("form.contact_details.email_address"), 
          class: 'govuk-label govuk-label--s'
        %>

        <%=
          render partial: "partials/form_input_errors",
                locals: {
                    form_object: @funding_application.people[p.index],
                    input_field_id: :email
                } if @funding_application.people[p.index].errors[:email].any?
        %>

        <%=
          p.text_field :email,
                        class: "govuk-input #{'govuk-input--error' if 
                          @funding_application.people[p.index].errors[:email].any? }"
        %>

      </div>

      <div class="govuk-form-group <%= 'govuk-form-group--error' if @funding_application.people[p.index].errors[:phone_number].any? %>">
      
        <%= 
          p.label t("form.contact_details.phone_number"), 
          class: 'govuk-label govuk-label--s'
        %>

        <%=
          render partial: "partials/form_input_errors",
                locals: {
                    form_object: @funding_application.people[p.index],
                    input_field_id: :phone_number
                } if @funding_application.people[p.index].errors[:phone_number].any?
        %>

        <%=
          p.text_field :phone_number,
                        class: "govuk-input govuk-!-width-two-thirds #{'govuk-input--error' if 
                          @funding_application.people[p.index].errors[:phone_number].any? }"
        %>      
      </div>

    </fieldset>

  <% end %>

</div>

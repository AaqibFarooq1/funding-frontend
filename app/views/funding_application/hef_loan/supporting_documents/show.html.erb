<%=
  render partial: "partials/page_title",
         locals: {
             model_object: @funding_application,
             page_title: "Upload your supporting documents"
         }
%>

<noscript><% no_js = true %></noscript>

<div id="summary-errors"></div>

<%=
  render partial: "partials/summary_errors",
         locals: {
             form_object: @funding_application.gp_hef_loan,
             first_form_element: :gp_hef_loan_supporting_documents_files
         } if @funding_application.gp_hef_loan.errors.any?
%>

<%=
  form_with model: @funding_application,
            url: :funding_application_hef_loan_supporting_documents,
            method: :put,
            remote: no_js ? false : true do |f|
%>

  <%= f.fields_for :gp_hef_loan do | loan | %>

<div class="govuk-form-group">

    <fieldset class="govuk-fieldset">

        <legend class="govuk-fieldset__legend govuk-fieldset__legend--xl govuk-!-margin-bottom-6">
            <h1 class="govuk-fieldset__heading">
                Upload your supporting documents
            </h1>
        </legend>

        <p class="govuk-body">
            Please upload your supporting documents.
        </p>

      <div id="funding_application.gp_hef_loan.supporting_documents_files-form-group"></div>

      <div id="supporting-documents-form-group-main"
           class="govuk-form-group nlhf-highlight-content govuk-!-margin-bottom-6">

        <div class="govuk-form-group" id="file-upload-form-group">

          <div id="form-group-errors"></div>

          <%=
            render partial: "partials/form_group_errors",
                   locals: {
                       form_object: @funding_application.gp_hef_loan
                   } if @funding_application.gp_hef_loan.errors.any?
          %>

          <div id="funding_application.gp_hef_loan.supporting_documents_files-errors"></div>
          <div class="govuk-form-group">
            <%=
              loan.label :supporting_documents_files,
                      "Add your supporting documents",
                      class: "govuk-heading-m nlhf-content-highlight__title"
            %>

            <%=
              loan.file_field :supporting_documents_files,
                           direct_upload: true,
                           multiple: true,
                           class: "govuk-file-upload #{"govuk-file-upload--error" if @funding_application.gp_hef_loan.errors.any?}"
            %>

            <%# See https://blog.yorkxin.org/2014/02/06/ajax-with-formdata-is-broken-on-ie10-ie11.html
            for the reasoning behind this workaround %>
            <input type="hidden" name="ieworkaround">

          </div>
        </div>
        <div class="govuk-form-group">
          <%=
            render(ButtonComponent.new(
                text: 'Add supporting documents',
                classes: "govuk-button--secondary",
                ))
          %>
        </div>


        <% unless @funding_application.gp_hef_loan.supporting_documents_files.attached? %>

          <p class="govuk-body">
            You have not added supporting documents
          </p>

        <% else %>

          <table class="govuk-table">

            <thead class="govuk-table__head">

            <tr class="govuk-table__row">

              <th scope="col" class="govuk-table__header">
                <%= I18n.t("accounts.accounts_file") %>
              </th>

            </tr>
            </thead>
            <tbody class="govuk-table__body">

            <% @funding_application.gp_hef_loan.supporting_documents_files.each do |sd| %>

              <tr>
                <td>
                  <%= link_to(sd.blob.filename,
                              rails_blob_path(sd, disposition: "attachment"))
                  %>
                </td>
              </tr>

            <% end %>

            </tbody>
          </table>

        <% end %>

      </div>

    </fieldset>

    <% end %>

<% end %>

  <%=
    render(
        ButtonComponent.new(
            element: "a",
            href: funding_application_hef_loan_declaration_path
        )
    )
  %>

</div>
